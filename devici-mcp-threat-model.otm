{
  "otmVersion": "0.2.0",
  "project": {
    "name": "DeviciMCP Security Assessment",
    "id": "devici-mcp-001",
    "description": "Threat model for DeviciMCP server - Model Context Protocol integration with Devici API",
    "owner": "Security Team",
    "ownerContact": "security@devici.com",
    "tags": ["mcp", "api", "threat-modeling", "python", "oauth2"],
    "attributes": {
      "initiative": "Security Review",
      "internetFacing": "yes",
      "repository": "devici-mcp"
    }
  },
  "representations": [
    {
      "name": "DeviciMCP Architecture",
      "id": "devici-mcp-arch",
      "type": "code",
      "size": {
        "width": 2000,
        "height": 1000
      }
    }
  ],
  "trustZones": [
    {
      "id": "internal-network",
      "name": "Internal Network",
      "type": "b61d6911-338d-46a8-9f39-8dcd24abfe91",
      "description": "Internal development environment",
      "risk": {
        "trustRating": 3
      }
    },
    {
      "id": "external-services",
      "name": "External Services",
      "type": "f0ba7722-39b6-4c81-8290-a30a248bb8d9",
      "description": "External APIs and services",
      "risk": {
        "trustRating": 1
      }
    },
    {
      "id": "file-system",
      "name": "Local File System",
      "type": "2ab4effa-40b7-4cd2-ba81-8247d29a6f2d",
      "description": "Local project files and environment",
      "risk": {
        "trustRating": 2
      }
    }
  ],
  "components": [
    {
      "id": "mcp-server",
      "name": "MCP Server",
      "type": "web-service",
      "description": "DeviciMCP server handling Model Context Protocol requests",
      "parent": {
        "trustZone": "internal-network"
      },
      "tags": ["python", "fastmcp", "server"],
      "attributes": {
        "technology": "Python/FastMCP",
        "authentication": "OAuth2",
        "protocols": ["HTTP", "MCP"]
      }
    },
    {
      "id": "devici-api",
      "name": "Devici API",
      "type": "external-service", 
      "description": "External Devici threat modeling platform API",
      "parent": {
        "trustZone": "external-services"
      },
      "tags": ["rest-api", "oauth2", "external"],
      "attributes": {
        "technology": "REST API",
        "endpoint": "api.devici.com",
        "authentication": "OAuth2 Client Credentials"
      }
    },
    {
      "id": "ai-assistant",
      "name": "AI Assistant",
      "type": "external-service",
      "description": "Claude/Cursor AI assistant consuming MCP tools",
      "parent": {
        "trustZone": "external-services"
      },
      "tags": ["ai", "mcp-client"],
      "attributes": {
        "technology": "AI Assistant",
        "protocols": ["MCP"]
      }
    },
    {
      "id": "project-files",
      "name": "Project Files",
      "type": "datastore",
      "description": "Local project files scanned for analysis",
      "parent": {
        "trustZone": "file-system"
      },
      "tags": ["files", "source-code"],
      "attributes": {
        "technology": "File System",
        "dataClassification": "Internal"
      }
    },
    {
      "id": "env-credentials",
      "name": "Environment Credentials",
      "type": "datastore",
      "description": "OAuth2 credentials and API keys",
      "parent": {
        "trustZone": "file-system"
      },
      "tags": ["credentials", "secrets"],
      "attributes": {
        "technology": "Environment Variables",
        "dataClassification": "Confidential"
      }
    }
  ],
  "dataflows": [
    {
      "id": "mcp-protocol",
      "name": "MCP Protocol Communication",
      "source": "ai-assistant",
      "destination": "mcp-server",
      "tags": ["mcp", "json-rpc"],
      "attributes": {
        "protocol": "MCP over stdio/HTTP",
        "authentication": "None",
        "encryption": "None"
      }
    },
    {
      "id": "api-requests",
      "name": "Devici API Requests",
      "source": "mcp-server",
      "destination": "devici-api",
      "tags": ["https", "oauth2"],
      "attributes": {
        "protocol": "HTTPS",
        "authentication": "OAuth2 Bearer Token",
        "encryption": "TLS 1.2+"
      }
    },
    {
      "id": "file-access",
      "name": "File System Access",
      "source": "mcp-server",
      "destination": "project-files",
      "tags": ["file-read"],
      "attributes": {
        "protocol": "File System",
        "authentication": "OS-level permissions",
        "encryption": "None"
      }
    },
    {
      "id": "credential-access",
      "name": "Credential Access",
      "source": "mcp-server",
      "destination": "env-credentials",
      "tags": ["secrets", "env-vars"],
      "attributes": {
        "protocol": "Environment Variables",
        "authentication": "Process-level access",
        "encryption": "None"
      }
    }
  ],
  "threats": [
    {
      "id": "T001",
      "name": "OAuth2 Token Theft",
      "description": "Attacker could steal OAuth2 credentials from environment variables or logs",
      "categories": ["STRIDE"],
      "cwes": ["CWE-522"],
      "status": "Open",
      "severity": "High",
      "type": "Spoofing",
      "targets": ["env-credentials", "mcp-server"],
      "attributes": {
        "STRIDE": ["Spoofing"],
        "riskAssessment": "High likelihood if credentials are logged or exposed in error messages"
      }
    },
    {
      "id": "T002", 
      "name": "Malicious File System Access",
      "description": "MCP server could be tricked into reading sensitive files outside project scope",
      "categories": ["STRIDE"],
      "cwes": ["CWE-22"],
      "status": "Open",
      "severity": "High",
      "type": "Information Disclosure",
      "targets": ["project-files", "mcp-server"],
      "attributes": {
        "STRIDE": ["Information Disclosure"],
        "riskAssessment": "Path traversal attacks could access system files"
      }
    },
    {
      "id": "T003",
      "name": "API Response Tampering",
      "description": "Man-in-the-middle attack on Devici API responses could inject malicious threat data",
      "categories": ["STRIDE"],
      "cwes": ["CWE-300"],
      "status": "Open", 
      "severity": "Medium",
      "type": "Tampering",
      "targets": ["devici-api", "api-requests"],
      "attributes": {
        "STRIDE": ["Tampering"],
        "riskAssessment": "HTTPS provides protection but certificate validation is critical"
      }
    },
    {
      "id": "T004",
      "name": "MCP Protocol Abuse",
      "description": "Malicious AI assistant could send crafted MCP requests to perform unauthorized actions",
      "categories": ["STRIDE"],
      "cwes": ["CWE-269"],
      "status": "Open",
      "severity": "High", 
      "type": "Elevation of Privilege",
      "targets": ["mcp-server", "ai-assistant"],
      "attributes": {
        "STRIDE": ["Elevation of Privilege"],
        "riskAssessment": "No authentication on MCP protocol allows any requests"
      }
    },
    {
      "id": "T005",
      "name": "Service Denial via Rate Limiting",
      "description": "Excessive API calls could trigger rate limiting and deny service to legitimate users",
      "categories": ["STRIDE"],
      "cwes": ["CWE-770"],
      "status": "Open",
      "severity": "Medium",
      "type": "Denial of Service", 
      "targets": ["devici-api", "mcp-server"],
      "attributes": {
        "STRIDE": ["Denial of Service"],
        "riskAssessment": "API rate limits could be exhausted by automated tools"
      }
    },
    {
      "id": "T006",
      "name": "OTM File Injection",
      "description": "Generated OTM files could contain malicious content that affects threat modeling tools",
      "categories": ["STRIDE"],
      "cwes": ["CWE-74"],
      "status": "Open",
      "severity": "Medium",
      "type": "Tampering",
      "targets": ["mcp-server"],
      "attributes": {
        "STRIDE": ["Tampering"],
        "riskAssessment": "JSON injection in generated OTM files could affect downstream tools"
      }
    }
  ],
  "mitigations": [
    {
      "id": "M001",
      "name": "Secure Credential Storage",
      "description": "Store OAuth2 credentials in secure environment variables or secret management system",
      "attributes": {
        "implemented": "Partial",
        "priority": "High"
      },
      "reducesRisk": [
        {
          "threat": "T001",
          "amount": 70
        }
      ]
    },
    {
      "id": "M002",
      "name": "File Access Validation",
      "description": "Implement path validation and sandboxing to prevent directory traversal attacks",
      "attributes": {
        "implemented": "No",
        "priority": "High"
      },
      "reducesRisk": [
        {
          "threat": "T002",
          "amount": 85
        }
      ]
    },
    {
      "id": "M003",
      "name": "Certificate Pinning",
      "description": "Implement certificate pinning for Devici API to prevent MITM attacks",
      "attributes": {
        "implemented": "No",
        "priority": "Medium"
      },
      "reducesRisk": [
        {
          "threat": "T003",
          "amount": 90
        }
      ]
    },
    {
      "id": "M004",
      "name": "MCP Request Validation",
      "description": "Implement input validation and rate limiting for MCP protocol requests",
      "attributes": {
        "implemented": "No",
        "priority": "High"
      },
      "reducesRisk": [
        {
          "threat": "T004",
          "amount": 75
        }
      ]
    },
    {
      "id": "M005",
      "name": "API Rate Limiting",
      "description": "Implement client-side rate limiting to prevent API quota exhaustion",
      "attributes": {
        "implemented": "No",
        "priority": "Medium"
      },
      "reducesRisk": [
        {
          "threat": "T005",
          "amount": 80
        }
      ]
    },
    {
      "id": "M006",
      "name": "Output Sanitization",
      "description": "Sanitize all generated OTM file content to prevent injection attacks",
      "attributes": {
        "implemented": "Partial",
        "priority": "Medium"
      },
      "reducesRisk": [
        {
          "threat": "T006",
          "amount": 85
        }
      ]
    }
  ]
} 